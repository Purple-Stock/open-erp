<div class="col-md-4 mb-4">
  <div class="card">
    <div class="card-header">
      <h5 class="card-title">
        <%= t('activerecord.attributes.production.service_order_number') %>: <%= production.service_order_number.presence || 'N/A' %>
      </h5>
    </div>
    <div class="card-body">
      <p><strong><%= Production.human_attribute_name(:tailor) %>:</strong> <%= production.tailor.name %></p>
      <p><strong><%= Production.human_attribute_name(:cut_date) %>:</strong> <%= pt_only_date_format(production.cut_date) if production.cut_date %></p>
      <p><strong><%= Production.human_attribute_name(:expected_delivery_date) %>:</strong> <%= l(production.expected_delivery_date) if production.expected_delivery_date %></p>
      <h6 class="mt-3"><%= t('.missing_pieces') %>:</h6>
      <ul>
        <% production.production_products.each do |pp| %>
          <% pieces_missing = pp.quantity - ((pp.pieces_delivered || 0) + (pp.dirty || 0) + (pp.error || 0) + (pp.discard || 0)) %>
          <% if pieces_missing > 0 %>
            <li>
              <%= "#{pp.product.name}: #{pieces_missing}" %>
              <small>
                (Total: <%= pp.quantity %>,
                Entregues: <%= pp.pieces_delivered || 0 %>,
                Sujo: <%= pp.dirty || 0 %>,
                Erro: <%= pp.error || 0 %>,
                Descarte: <%= pp.discard || 0 %>)
              </small>
            </li>
          <% end %>
        <% end %>
      </ul>
    </div>
    <div class="card-footer">
      <%= link_to t('helpers.links.edit'), edit_production_path(production), class: 'btn btn-primary btn-sm' %>
      <%= link_to t('helpers.links.show'), production_path(production), class: 'btn btn-info btn-sm' %>
    </div>
  </div>
</div>
