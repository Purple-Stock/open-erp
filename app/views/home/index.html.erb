<div class="container-ultra-wide">
<div class="section">
    <br>
    <p>Última Atualização: <%= @last_update %></p>
    <p>Token Expira: <%= @expires_at %></p>
  <% if @monthly_revenue_estimation.present? %>
    <p>A meta da quantidade a ser vendida nesse mês é de: <%= @monthly_revenue_estimation.quantity %>.
      Baseados em uma meta da receita de: <%= number_to_currency_pt_br @monthly_revenue_estimation.revenue %>
      e com um ticket médio de: <%= number_to_currency_pt_br @monthly_revenue_estimation.average_ticket %></p>
  <% else %>
    <p><%= link_to 'Estimar quantidade esperadas para o mês atual', new_revenue_estimation_path %></p>
  <% end %>

  <div class="row">
  <div class="col-12 col-md-12 col-xl4 bordered-section">
    <h1>Pedidos de Hoje</h1>
    <% if @date_expires < Time.now %>
      <a target="_blank" href="https://www.bling.com.br/OAuth2/views/authorization.php?response_type=code&client_id=<%= ENV['CLIENT_ID']%>&state=323eb862289daff1f11ee6c23edb4f6e&scopes=98308+98309+98310+98313+98314+98565+98619+101584+507943+575904+5990556+6631498+106168710+182224097+199272829+200802821+220621674+318257547+318257550+318257553+318257556+318257559+318257561+318257565+318257568+318257570+318257573+318257576+318257583+333936575+363921589+363921590+363921591+363921592+363921598+363921599+363953167+363953556+363953706+791588404+875116881+875116885+1649295804+1780272711+1869535257+5862218180+6239411327+6239420709+13645012976+13645012997+13645012998">Atualizar Token</a>
    <% end %>
    <div class="row justify-content-center">
      <% @current_order_items.group_by(&:store_id).each do |store_id, items| %>
        <% loja_name = items.first.store_name %>
        <div class="col-md-4">
          <div class="card mb-4">
            <div class="card-body text-center">
              <h5 class="card-title">
                <%= loja_name %>
              </h5>
              <% if @monthly_revenue_estimation.present? %>
                <p>
                  Meta de Pedidos: <%= @monthly_revenue_estimation.daily_quantity %>
                </p>
            <% end %>
              <p>
                Pedidos: <%= items.group_by(&:bling_order_id).compact.count %>
              </p>
              <p class="hidden-value">
                Total: <%= number_to_currency_pt_br items.sum(&:valor) %>
              </p>
            </div>
          </div>
        </div>
      <% end %>

      <% if @current_order_items.blank? %>
        <div class="col-md-4">
          <div class="card mb-4">
            <div class="card-body text-center">
              <p>
                Os pedidos do dia aparecerão aqui
              </p>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  </div>
  <div class="col-12 col-md-12 col-xl4 bordered-section">
    <h1>Pedidos Feitos do dia(checados e verificados)</h1>
    <%= render 'order_items', order_items: @current_done_order_items %>
  </div>
  <div class="col-12 col-md-12 col-xl4 bordered-section">
    <h1>Status Shein</h1>
    <div class="row justify-content-center">
      <div class="col-md-4">
        <div class="card mb-4">
          <div class="card-body text-center">
            <h5 class="card-title">
              Pendentes Shein
            </h5>
            <p>
              Quantidade de Pedidos: <%= @shein_pending_count %>
            </p>
            <p>
              Em Andamento Bling: <%= @in_progress = @in_progress_order_items.where(store_id: '204219105').group_by(&:bling_order_id).count %>
            </p>
            <p>
              Diferença: <%= @shein_pending_count - @in_progress %>
            </p>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card mb-4">
          <div class="card-body text-center">
            <h5 class="card-title">
              Pedidos a serem coletados
            </h5>
            <p>
              Quantidade de Pedidos: <%= @shein_orders_count %>
            </p>
            <p>
              Pendentes Bling: <%= @pending = @pending_order_items.where(store_id: '204219105').group_by(&:bling_order_id).count %>
            </p>
            <p>
              Impressos Bling: <%= @printed = @printed_order_items.where(store_id: '204219105').group_by(&:bling_order_id).count %>
            </p>
            <p>
              Diferença: <%= @shein_orders_count - @pending - @printed%>
            </p>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card mb-4">
          <div class="card-body text-center">
            <h5 class="card-title">
              Pedidos Atrasados
            </h5>
            <p>
              Quantidade de Pedidos: <%= @expired_orders_count %>
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
  <div class="row">
    <div class="col-12 col-md-12 col-xl4 bordered-section">
      <h1>Pedidos Impressos</h1>
      <%= render 'order_items', order_items: @printed_order_items %>
    </div>
    <div class="col-12 col-md-12 col-xl4 bordered-section">
      <h1>Pedidos Pendentes</h1>
      <%= render 'order_items', order_items: @pending_order_items %>
    </div>
    <div class="col-12 col-md-12 col-xl4 bordered-section">
      <h1>Pedidos Em andamento(Pagos)</h1>
      <%= render 'order_items', order_items: @in_progress_order_items %>
    </div>
  </div>
</div>

</div>
</div>

<script>
  setInterval(function() {
      window.location.reload();
  }, 60000);
</script>